<view class="container">

<!-- 加载提示框 -->
<view wx:if="{{isLoading}}" class="loading-overlay">
  <view class="loading-spinner">
    <view class="spinner"></view>
    <text class="loading-text">正在加载...</text>
  </view>
</view>

<!-- 讨论区卡片循环 -->
<view class="discussion-card" wx:for="{{cards}}" wx:key="cardName">
  <!-- 卡片头部 -->
  <view 
    class="card-header {{cardsExpanded[index] ? 'expanded' : ''}}" 
    bindtap="toggleCard" 
    data-index="{{index}}"
  >
    <view class="discussion-info">
      <text class="discussion-name">{{item.cardName}}区</text>
      <text class="discussion-status">
        使用中: {{item.usingCount}} | 空闲中: {{item.freeCount}}
      </text>
    </view>
    <image 
      class="arrow-icon" 
      src="/images/icons/arrow-down.png" 
      mode="aspectFit"
    ></image>
  </view>

  <!-- 可折叠内容区域 -->
  <view 
    class="card-content" 
    style="height: {{cardsExpanded[index] ? item.discussionAreas.length * 147 + 'rpx' : '0'}};"
  >
    <scroll-view 
      scroll-y 
      class="scroll-area" 
      style="height: 100%;"
    >
      <view class="discussion-grid">
        <!-- 讨论区按钮 -->
        <view 
          class="discussion-btn {{discussion.status === 'available' ? 'available' : 'occupied'}}" 
          wx:for="{{item.discussionAreas}}" 
          wx:for-item="discussion"
          wx:key="topicId"
          bindtap="bookDiscussion" 
          data-id="{{discussion._id}}"
          data-status="{{discussion.status}}"
        >
          <view class="discussion-info-left">
            <image class="discussion-icon" src="/images/icons/discussion_area.png"></image>
            <text class="discussion-number">{{discussion.floor}}-{{discussion.topicId}}</text>
          </view>
          <view class="discussion-info-right">
            <text class="discussion-capacity">容量: {{discussion.capacity}}</text>
            <text class="status-text">{{discussion.status === 'available' ? '可预约' : '使用中'}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
</view>

<!-- 预约模态框 -->
<view wx:if="{{isModalVisible}}" class="modal-container">
<view class="modal-content">
  <!-- 日期选择器 -->
  <picker 
    mode="selector" 
    range="{{dateOptions}}" 
    value="{{dateIndex}}" 
    bindchange="selectDate"
  >
    <view>选择日期：{{selectedDate || '请选择日期'}}</view>
  </picker>

  <!-- 时间段选择器 -->
  <picker 
    mode="selector" 
    range="{{timeSlots}}" 
    bindchange="selectTimeSlot"
  >
    <view>选择时间段：{{selectedTimeSlot || '请选择时间段'}}</view>
  </picker>
  
  <!-- 加载指示器 -->
  <view wx:if="{{isSubmitting}}" class="loading-indicator">正在处理...</view>
  
  <!-- 按钮组 -->
  <view class="button-group" wx:if="{{!isSubmitting}}">
    <button class="confirm-btn" bindtap="confirmBooking" disabled="{{isSubmitting}}">确定</button>
    <button class="cancel-btn" bindtap="cancelBooking" disabled="{{isSubmitting}}">取消</button>
  </view>
</view>
</view>