<view class="container">
<!-- 加载提示框 -->
<view wx:if="{{isLoading}}" class="loading-overlay">
    <view class="loading-spinner">
      <view class="spinner"></view>
      <text class="loading-text">正在加载...</text>
    </view>
  </view>
  <!-- 楼层导航 -->
  <scroll-view scroll-x class="floor-nav">
    <block wx:for="{{floors}}" wx:key="floor">
      <view 
        class="nav-item {{activeFloor === index ? 'active' : ''}}"
        bindtap="switchFloor"
        data-index="{{index}}"
      >
        {{item.floor}}楼
      </view>
    </block>
  </scroll-view>

  <!-- 区域折叠面板 -->
  <view class="area-list">
    <block wx:for="{{floors[activeFloor].areas}}" wx:key="areaName">
      <view class="area-card">
        <!-- 区域头部 -->
        <view 
          class="area-header {{areaExpanded[index] ? 'expanded' : ''}}"
          bindtap="toggleArea"
          data-floor="{{activeFloor}}"
          data-area="{{index}}"
        >
          <text class="area-name">{{item.areaName}}区</text>
          <view class="status-indicator">
            <text class="available-count">{{item.availableSeats}}/{{item.totalSeats}} 可用</text>
            <image 
              class="arrow-icon"
              src="/images/icons/arrow-down.png"
              mode="aspectFit"
            ></image>
          </view>
        </view>

        <!-- 座位滚动容器 -->
        <scroll-view 
          class="seat-scroll" 
          scroll-y 
          style="height: {{areaExpanded[index] ? '500rpx' : '0'}};"
        >
          <view class="seat-grid">
            <block wx:for="{{item.seats}}" wx:key="seatId">
              <view 
                class="seat-item {{item.status === 'available' ? 'available' : 'occupied'}}"
                bindtap="bookSeat"
                data-seatid="{{item.seatId}}"
                data-status="{{item.status}}"
                data-id="{{item._id}}"
              >
              <view class="seat-background {{item.status === 'available' ? 'available-bg' : 'occupied-bg'}}"></view>
                <image 
                  class="seat-icon"
                  src="/images/icons/seat_available.png"
                ></image>
                <text class="seat-id">{{item.seatId}}</text>
              </view>
            </block>
          </view>
        </scroll-view>
      </view>
    </block>
  </view>

  <!-- 预约模态框 -->
  <view wx:if="{{isModalVisible}}" class="modal-container">
    <view class="modal-content">
      <!-- 日期选择器 -->
      <picker 
        mode="selector" 
        range="{{dateOptions}}" 
        value="{{dateIndex}}" 
        bindchange="selectDate"
      >
        <view class="picker-container">
          <text class="picker-label">选择日期：</text>
          <view class="picker-value">{{selectedDate || '请选择日期'}}</view>
        </view>
      </picker>

      <!-- 时间段选择器 -->
      <picker 
        mode="selector" 
        range="{{timeSlots}}" 
        bindchange="selectTimeSlot"
      >
        <view class="picker-container">
          <text class="picker-label">选择时间段：</text>
          <view class="picker-value">{{selectedTimeSlot || '请选择时间段'}}</view>
        </view>
      </picker>
      
      <!-- 加载指示器 -->
      <view wx:if="{{isSubmitting}}" class="loading-indicator">正在处理...</view>
      
      <!-- 按钮组 -->
      <view class="button-group" wx:if="{{!isSubmitting}}">
        <button class="confirm-btn" bindtap="confirmBooking" disabled="{{isSubmitting}}">确定</button>
        <button class="cancel-btn" bindtap="cancelBooking" disabled="{{isSubmitting}}">取消</button>
      </view>
    </view>
  </view>
</view>